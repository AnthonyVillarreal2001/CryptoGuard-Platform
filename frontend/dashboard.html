<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoGuard - Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
        }
        .container {
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #2c3e50 0%, #1a252f 100%);
            color: white;
            padding: 25px;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 30px;
            font-size: 20px;
        }
        .user-info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .nav-menu {
            list-style: none;
            margin-bottom: 30px;
        }
        .nav-item {
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .nav-item:hover {
            background: rgba(255,255,255,0.1);
        }
        .nav-item.active {
            background: #3498db;
        }
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        .header {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .btn {
            padding: 12px 25px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn:hover { 
            background: #2980b9;
            transform: translateY(-2px);
        }
        .btn-logout {
            background: #e74c3c;
            width: 100%;
        }
        .btn-logout:hover { background: #c0392b; }
        .content-section {
            display: none;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        .content-section.active { 
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .crypto-tools textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            font-size: 14px;
            resize: vertical;
        }
        .algorithm-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .algo-btn {
            padding: 10px 20px;
            background: #ecf0f1;
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        .algo-btn.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(150%);
            transition: transform 0.3s;
            z-index: 1000;
        }
        .notification.show { transform: translateX(0); }
        .success { background: #27ae60; }
        .error { background: #e74c3c; }
        .info { background: #3498db; }
        .warning { background: #f39c12; }
        
        .input-group {
            margin: 15px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .document-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .crypto-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <div class="logo">
                <h2>üîê CryptoGuard</h2>
            </div>
            
            <div class="user-info">
                <h3 id="username">Usuario</h3>
                <p id="email">email@ejemplo.com</p>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item active" data-section="dashboard">
                    üìä Dashboard
                </li>
                <li class="nav-item" data-section="crypto">
                    üîê Cifrado/Descifrado
                </li>
                <li class="nav-item" data-section="documents">
                    üìÑ Documentos
                </li>
                <li class="nav-item" data-section="logs">
                    üìã Historial
                </li>
                <li class="nav-item" data-section="profile">
                    üë§ Perfil
                </li>
                <li class="nav-item" data-section="test">
                    üß™ Pruebas
                </li>
            </ul>
            
            <button class="btn btn-logout" id="logoutBtn">
                üö™ Cerrar Sesi√≥n
            </button>
        </nav>
        
        <main class="main-content">
            <div class="header">
                <div>
                    <h1 id="pageTitle">Dashboard</h1>
                    <p>Plataforma de t√©cnicas criptogr√°ficas</p>
                </div>
                <div>
                    <span id="connectionStatus" style="color: #27ae60;">‚óè Conectado</span>
                </div>
            </div>
            
            <!-- Dashboard -->
            <div class="content-section active" id="dashboard-section">
                <h2>üìà Estad√≠sticas</h2>
                <div class="stats">
                    <div class="stat-card">
                        <h3>üìÑ Documentos</h3>
                        <p id="docCount">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>‚ö° Operaciones</h3>
                        <p id="opCount">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>üîë Algoritmos</h3>
                        <p>4 disponibles</p>
                    </div>
                    <div class="stat-card">
                        <h3>üë§ Usuario</h3>
                        <p id="userRole">Activo</p>
                    </div>
                </div>
                
                <h2>‚ö° Acciones R√°pidas</h2>
                <div class="action-buttons">
                    <button class="btn" onclick="showSection('crypto')">
                        üîê Probar Cifrado
                    </button>
                    <button class="btn" id="createDocBtn">
                        üìÑ Nuevo Documento
                    </button>
                    <button class="btn" onclick="showSection('test')">
                        üß™ Ejecutar Pruebas
                    </button>
                    <button class="btn" onclick="testConnection()">
                        üîó Probar Conexi√≥n
                    </button>
                </div>
                
                <div class="crypto-info">
                    <h3>üìö Algoritmos Disponibles:</h3>
                    <ul style="margin-top: 10px;">
                        <li><strong>AES-256:</strong> Cifrado sim√©trico avanzado</li>
                        <li><strong>RSA-2048:</strong> Cifrado asim√©trico seguro</li>
                        <li><strong>Vigen√®re:</strong> Cifrado cl√°sico polialfab√©tico</li>
                        <li><strong>SHA-256:</strong> Funci√≥n hash criptogr√°fica</li>
                    </ul>
                </div>
            </div>
            
            <!-- Herramientas Criptogr√°ficas -->
            <div class="content-section" id="crypto-section">
                <h2>üîê Herramientas Criptogr√°ficas</h2>
                
                <div class="algorithm-buttons">
                    <button class="algo-btn active" data-algo="AES">
                        üîë AES-256
                    </button>
                    <button class="algo-btn" data-algo="RSA">
                        üóùÔ∏è RSA-2048
                    </button>
                    <button class="algo-btn" data-algo="VIGENERE">
                        üèõÔ∏è Vigen√®re
                    </button>
                    <button class="algo-btn" data-algo="SHA256">
                        #Ô∏è‚É£ SHA-256
                    </button>
                </div>
                
                <div class="input-group">
                    <label>üìù Texto de entrada:</label>
                    <textarea id="inputText" placeholder="Escribe el texto aqu√≠...">Hola Mundo Crypto 2024</textarea>
                </div>
                
                <div id="keyInput" class="input-group" style="display: none;">
                    <label>üîë Clave (para Vigen√®re):</label>
                    <input type="text" id="cryptoKey" placeholder="EJEMPLO" value="SECRETO">
                </div>
                
                <div id="ivInput" class="input-group" style="display: none;">
                    <label>üîÑ IV (para descifrar AES):</label>
                    <input type="text" id="cryptoIv" placeholder="Pega el IV aqu√≠...">
                </div>
                
                <div class="action-buttons">
                    <button class="btn" id="encryptBtn">
                        üîí Cifrar
                    </button>
                    <button class="btn" id="decryptBtn">
                        üîì Descifrar
                    </button>
                    <button class="btn" id="clearBtn">
                        üóëÔ∏è Limpiar
                    </button>
                    <button class="btn" id="copyBtn">
                        üìã Copiar Resultado
                    </button>
                </div>
                
                <div class="input-group">
                    <label>üìä Resultado:</label>
                    <textarea id="outputText" readonly placeholder="El resultado aparecer√° aqu√≠..."></textarea>
                </div>
                
                <div id="resultInfo" class="crypto-info">
                    <p>üí° <strong>Instrucciones:</strong></p>
                    <ul style="margin-top: 5px;">
                        <li><strong>AES:</strong> Para descifrar, necesitas el IV generado durante el cifrado</li>
                        <li><strong>RSA:</strong> Solo para textos cortos (menos de 190 caracteres)</li>
                        <li><strong>Vigen√®re:</strong> Solo letras may√∫sculas, necesita clave</li>
                        <li><strong>SHA-256:</strong> Solo hash, no se puede descifrar</li>
                    </ul>
                </div>
            </div>
            
            <!-- Documentos -->
            <div class="content-section" id="documents-section">
                <h2>üìÑ Mis Documentos</h2>
                <button class="btn" id="newDocBtn" style="margin-bottom: 20px;">
                    ‚ûï Nuevo Documento
                </button>
                
                <div id="documentsList">
                    <p>Cargando documentos...</p>
                </div>
            </div>
            
            <!-- Historial -->
            <div class="content-section" id="logs-section">
                <h2>üìã Historial de Actividades</h2>
                <button class="btn" onclick="loadLogs()" style="margin-bottom: 20px;">
                    üîÑ Actualizar
                </button>
                
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Acci√≥n</th>
                            <th>Algoritmo</th>
                            <th>Entrada</th>
                            <th>Salida</th>
                        </tr>
                    </thead>
                    <tbody id="logsTable">
                        <tr><td colspan="5">Cargando...</td></tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Perfil -->
            <div class="content-section" id="profile-section">
                <h2>üë§ Perfil de Usuario</h2>
                <div id="profileInfo">
                    <p>Cargando informaci√≥n...</p>
                </div>
            </div>
            
            <!-- Pruebas -->
            <div class="content-section" id="test-section">
                <h2>üß™ Pruebas Criptogr√°ficas</h2>
                
                <div class="crypto-info">
                    <p>Ejecuta pruebas para verificar que todos los algoritmos funcionan correctamente:</p>
                </div>
                
                <div class="action-buttons">
                    <button class="btn" onclick="runAllTests()">
                        üß™ Ejecutar Todas las Pruebas
                    </button>
                    <button class="btn" onclick="runAesTest()">
                        üîë Probar AES
                    </button>
                    <button class="btn" onclick="runRsaTest()">
                        üóùÔ∏è Probar RSA
                    </button>
                    <button class="btn" onclick="runVigenereTest()">
                        üèõÔ∏è Probar Vigen√®re
                    </button>
                    <button class="btn" onclick="runSha256Test()">
                        #Ô∏è‚É£ Probar SHA-256
                    </button>
                </div>
                
                <div class="input-group">
                    <label>üìä Resultados de Pruebas:</label>
                    <textarea id="testResults" readonly rows="15" placeholder="Los resultados de las pruebas aparecer√°n aqu√≠..."></textarea>
                </div>
            </div>
        </main>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // Variables globales
        let currentToken = localStorage.getItem('token');
        let currentUser = JSON.parse(localStorage.getItem('user') || '{}');
        let currentAlgorithm = 'AES';
        let lastEncryptionResult = null;
        
        // Verificar sesi√≥n
        if (!currentToken) {
            window.location.href = 'index.html';
        }
        
        // Mostrar informaci√≥n del usuario
        document.getElementById('username').textContent = currentUser.username || 'Usuario';
        document.getElementById('email').textContent = currentUser.email || 'email@ejemplo.com';
        
        // Notificaci√≥n
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            setTimeout(() => notification.classList.remove('show'), 4000);
        }
        
        // Navegaci√≥n
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                showSection(this.dataset.section);
            });
        });
        
        function showSection(section) {
            document.querySelectorAll('.content-section').forEach(s => {
                s.classList.remove('active');
            });
            document.getElementById(`${section}-section`).classList.add('active');
            
            const titles = {
                'dashboard': 'Dashboard',
                'crypto': 'Herramientas Criptogr√°ficas',
                'documents': 'Documentos',
                'logs': 'Historial',
                'profile': 'Perfil',
                'test': 'Pruebas'
            };
            document.getElementById('pageTitle').textContent = titles[section] || 'CryptoGuard';
        }
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        });
        
        // Probar conexi√≥n
        async function testConnection() {
            try {
                showNotification('Probando conexi√≥n...', 'info');
                const response = await fetch('http://localhost:5000/api/health');
                const data = await response.json();
                
                if (response.ok) {
                    showNotification('‚úÖ Conexi√≥n exitosa con el servidor', 'success');
                    document.getElementById('connectionStatus').textContent = '‚óè Conectado';
                    document.getElementById('connectionStatus').style.color = '#27ae60';
                } else {
                    showNotification('‚ùå Error en la conexi√≥n', 'error');
                }
            } catch (error) {
                showNotification('‚ùå No se pudo conectar al servidor', 'error');
                document.getElementById('connectionStatus').textContent = '‚óè Desconectado';
                document.getElementById('connectionStatus').style.color = '#e74c3c';
            }
        }
        
        // Herramientas criptogr√°ficas
        document.querySelectorAll('.algo-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.algo-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentAlgorithm = this.dataset.algo;
                
                // Mostrar/ocultar campos seg√∫n algoritmo
                const keyInput = document.getElementById('keyInput');
                const ivInput = document.getElementById('ivInput');
                
                if (currentAlgorithm === 'VIGENERE') {
                    keyInput.style.display = 'block';
                    ivInput.style.display = 'none';
                } else if (currentAlgorithm === 'AES') {
                    keyInput.style.display = 'none';
                    ivInput.style.display = 'none'; // Solo para descifrar
                } else {
                    keyInput.style.display = 'none';
                    ivInput.style.display = 'none';
                }
                
                // Limpiar campos
                document.getElementById('cryptoIv').value = '';
                
                showNotification(`Algoritmo seleccionado: ${currentAlgorithm}`, 'info');
            });
        });
        
        // Cifrar
        document.getElementById('encryptBtn').addEventListener('click', async () => {
            const text = document.getElementById('inputText').value.trim();
            const key = document.getElementById('cryptoKey').value.trim();
            
            if (!text) {
                showNotification('Ingresa un texto para cifrar', 'error');
                return;
            }
            
            if (currentAlgorithm === 'VIGENERE' && !key) {
                showNotification('Ingresa una clave para Vigen√®re', 'error');
                return;
            }
            
            if (currentAlgorithm === 'RSA' && text.length > 190) {
                showNotification('Texto muy largo para RSA. Usa AES para textos largos.', 'warning');
                return;
            }
            
            try {
                showNotification('Cifrando...', 'info');
                
                const payload = {
                    text: text,
                    algorithm: currentAlgorithm
                };
                
                if (currentAlgorithm === 'VIGENERE') {
                    payload.key = key;
                }
                
                const response = await fetch('http://localhost:5000/api/crypto/encrypt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    lastEncryptionResult = data.result;
                    let output = '';
                    
                    if (currentAlgorithm === 'AES') {
                        output = `üîí CIFRADO AES-256:\n\nüìù Texto cifrado:\n${data.result.encrypted}\n\nüîÑ IV (gu√°rdalo para descifrar):\n${data.result.iv}\n\nüìå Algoritmo: ${data.algorithm}`;
                        // Mostrar campo para IV para futuros descifrados
                        document.getElementById('ivInput').style.display = 'block';
                        document.getElementById('cryptoIv').value = data.result.iv;
                    } else if (currentAlgorithm === 'RSA') {
                        output = `üîí CIFRADO RSA-2048:\n\nüìù Texto cifrado:\n${data.result.encrypted}\n\nüìå Algoritmo: ${data.algorithm}`;
                    } else if (currentAlgorithm === 'VIGENERE') {
                        output = `üîí CIFRADO VIGEN√àRE:\n\nüìù Texto cifrado:\n${data.result.encrypted}\n\nüîë Clave usada: ${data.result.key}\n\nüìå Algoritmo: ${data.algorithm}`;
                    } else if (currentAlgorithm === 'SHA256') {
                        output = `#Ô∏è‚É£ HASH SHA-256:\n\nüìù Hash generado:\n${data.result.hash}\n\n‚ö†Ô∏è Nota: SHA-256 es una funci√≥n hash, no se puede descifrar.\n\nüìå Algoritmo: ${data.algorithm}`;
                    }
                    
                    document.getElementById('outputText').value = output;
                    showNotification('‚úÖ Cifrado completado', 'success');
                } else {
                    showNotification(data.error || 'Error al cifrar', 'error');
                }
            } catch (error) {
                showNotification('‚ùå Error de conexi√≥n', 'error');
                console.error('Error:', error);
            }
        });
        
        // Descifrar
        document.getElementById('decryptBtn').addEventListener('click', async () => {
            const text = document.getElementById('inputText').value.trim();
            const key = document.getElementById('cryptoKey').value.trim();
            const iv = document.getElementById('cryptoIv').value.trim();
            
            if (!text) {
                showNotification('Ingresa un texto cifrado', 'error');
                return;
            }
            
            // SHA256 NO SE PUEDE DESCIFRAR
            if (currentAlgorithm === 'SHA256') {
                showNotification('‚ö†Ô∏è SHA-256 es una funci√≥n hash, no se puede descifrar', 'warning');
                return;
            }
            
            try {
                showNotification('Descifrando...', 'info');
                
                const payload = {
                    algorithm: currentAlgorithm,
                    encrypted_text: text
                };
                
                if (currentAlgorithm === 'VIGENERE') {
                    if (!key) {
                        showNotification('Ingresa la clave para Vigen√®re', 'error');
                        return;
                    }
                    payload.key = key;
                }
                
                if (currentAlgorithm === 'AES') {
                    if (!iv) {
                        showNotification('Ingresa el IV para descifrar AES', 'error');
                        return;
                    }
                    payload.iv = iv;
                }
                
                const response = await fetch('http://localhost:5000/api/crypto/decrypt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('outputText').value = 
                        `üîì TEXTO DESCIFRADO:\n\nüìù Texto original:\n${data.result}\n\nüìå Algoritmo: ${data.algorithm}\n\n‚úÖ Descifrado exitoso`;
                    showNotification('‚úÖ Descifrado completado', 'success');
                } else {
                    showNotification(data.error || 'Error al descifrar', 'error');
                }
            } catch (error) {
                showNotification('‚ùå Error de conexi√≥n', 'error');
                console.error('Error:', error);
            }
        });
        
        // Limpiar
        document.getElementById('clearBtn').addEventListener('click', () => {
            document.getElementById('inputText').value = '';
            document.getElementById('outputText').value = '';
            document.getElementById('cryptoKey').value = '';
            document.getElementById('cryptoIv').value = '';
            lastEncryptionResult = null;
            showNotification('Campos limpiados', 'info');
        });
        
        // Copiar resultado
        document.getElementById('copyBtn').addEventListener('click', () => {
            const outputText = document.getElementById('outputText');
            if (!outputText.value.trim()) {
                showNotification('No hay resultado para copiar', 'warning');
                return;
            }
            
            navigator.clipboard.writeText(outputText.value)
                .then(() => showNotification('‚úÖ Resultado copiado al portapapeles', 'success'))
                .catch(err => {
                    console.error('Error al copiar:', err);
                    showNotification('‚ùå Error al copiar', 'error');
                });
        });
        
        // Documentos
        document.getElementById('newDocBtn').addEventListener('click', async () => {
            const title = prompt('üìù T√≠tulo del documento:');
            if (!title) return;
            
            const content = prompt('üìÑ Contenido del documento:');
            if (!content) return;
            
            const encryption = prompt('üîê Tipo de cifrado (AES/RSA/VIGENERE):', 'AES').toUpperCase();
            if (!['AES', 'RSA', 'VIGENERE'].includes(encryption)) {
                showNotification('Tipo de cifrado no v√°lido', 'error');
                return;
            }
            
            const payload = {
                title: title,
                content: content,
                encryption_type: encryption
            };
            
            if (encryption === 'VIGENERE') {
                const key = prompt('üîë Clave para Vigen√®re:');
                if (!key) return;
                payload.key = key;
            }
            
            try {
                showNotification('Creando documento...', 'info');
                
                const response = await fetch('http://localhost:5000/api/documents', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showNotification('‚úÖ Documento creado exitosamente', 'success');
                    loadDocuments();
                } else {
                    showNotification(data.error || 'Error al crear documento', 'error');
                }
            } catch (error) {
                showNotification('‚ùå Error de conexi√≥n', 'error');
            }
        });
        
        async function loadDocuments() {
            try {
                const response = await fetch('http://localhost:5000/api/documents', {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const container = document.getElementById('documentsList');
                    if (data.documents.length === 0) {
                        container.innerHTML = '<p>üì≠ No hay documentos guardados</p>';
                        return;
                    }
                    
                    let html = '';
                    data.documents.forEach(doc => {
                        html += `
                            <div class="document-item">
                                <h4>${doc.title}</h4>
                                <p><small>üîê ${doc.encryption_type} | üìÖ ${new Date(doc.created_at).toLocaleDateString()}</small></p>
                                <button class="btn" style="padding: 5px 10px; font-size: 12px;" 
                                        onclick="viewDocument(${doc.id})">
                                    üëÅÔ∏è Ver
                                </button>
                            </div>
                        `;
                    });
                    
                    container.innerHTML = html;
                    document.getElementById('docCount').textContent = data.count;
                }
            } catch (error) {
                console.error('Error cargando documentos:', error);
            }
        }
        
        async function viewDocument(docId) {
            try {
                showNotification('Cargando documento...', 'info');
                
                const response = await fetch(`http://localhost:5000/api/documents/${docId}`, {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const doc = data.document;
                    const content = prompt(`üìÑ ${doc.title}\nüîê ${doc.encryption_type}\n\nContenido:`, doc.content);
                    if (content !== null) {
                        showNotification('Documento cargado', 'success');
                    }
                } else {
                    showNotification(data.error || 'Error al cargar documento', 'error');
                }
            } catch (error) {
                showNotification('‚ùå Error de conexi√≥n', 'error');
            }
        }
        
        async function loadLogs() {
            try {
                const response = await fetch('http://localhost:5000/api/logs', {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const tbody = document.getElementById('logsTable');
                    if (data.logs.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5">üì≠ No hay registros de actividad</td></tr>';
                        return;
                    }
                    
                    let html = '';
                    data.logs.forEach(log => {
                        html += `
                            <tr>
                                <td>${new Date(log.timestamp).toLocaleString()}</td>
                                <td><strong>${log.action}</strong></td>
                                <td>${log.algorithm || '-'}</td>
                                <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
                                    ${log.input_data || '-'}
                                </td>
                                <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
                                    ${log.output_data || '-'}
                                </td>
                            </tr>
                        `;
                    });
                    
                    tbody.innerHTML = html;
                    document.getElementById('opCount').textContent = data.count;
                }
            } catch (error) {
                console.error('Error cargando logs:', error);
            }
        }
        
        async function loadProfile() {
            try {
                const response = await fetch('http://localhost:5000/api/user/profile', {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const user = data.user;
                    document.getElementById('profileInfo').innerHTML = `
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                            <p><strong>üë§ Usuario:</strong> ${user.username}</p>
                            <p><strong>üìß Email:</strong> ${user.email}</p>
                            <p><strong>üìÖ Registrado:</strong> ${new Date(user.created_at).toLocaleDateString()}</p>
                            <p><strong>üÜî ID:</strong> ${user.id}</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error cargando perfil:', error);
            }
        }
        
        // Funciones de pruebas
        async function runAllTests() {
            showNotification('Ejecutando todas las pruebas...', 'info');
            const results = document.getElementById('testResults');
            results.value = 'üß™ EJECUTANDO PRUEBAS CRIPTOGR√ÅFICAS...\n\n';
            
            await runAesTest();
            await runRsaTest();
            await runVigenereTest();
            await runSha256Test();
            
            showNotification('‚úÖ Todas las pruebas completadas', 'success');
        }
        
        async function runAesTest() {
            try {
                const response = await fetch('http://localhost:5000/api/crypto/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'aes' })
                });
                
                const data = await response.json();
                const results = document.getElementById('testResults');
                
                if (response.ok && data.tests.AES.success) {
                    results.value += `‚úÖ PRUEBA AES-256: EXITOSA\n`;
                    results.value += `   Texto original: "${data.tests.AES.original}"\n`;
                    results.value += `   Texto descifrado: "${data.tests.AES.decrypted}"\n`;
                    results.value += `   Coinciden: ${data.tests.AES.success ? 'S√ç' : 'NO'}\n\n`;
                } else {
                    results.value += `‚ùå PRUEBA AES-256: FALLIDA\n\n`;
                }
            } catch (error) {
                const results = document.getElementById('testResults');
                results.value += `‚ùå PRUEBA AES-256: ERROR DE CONEXI√ìN\n\n`;
            }
        }
        
        async function runRsaTest() {
            try {
                const response = await fetch('http://localhost:5000/api/crypto/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'rsa' })
                });
                
                const data = await response.json();
                const results = document.getElementById('testResults');
                
                if (response.ok && data.tests.RSA.success) {
                    results.value += `‚úÖ PRUEBA RSA-2048: EXITOSA\n`;
                    results.value += `   Texto original: "${data.tests.RSA.original}"\n`;
                    results.value += `   Texto descifrado: "${data.tests.RSA.decrypted}"\n`;
                    results.value += `   Coinciden: ${data.tests.RSA.success ? 'S√ç' : 'NO'}\n\n`;
                } else {
                    results.value += `‚ùå PRUEBA RSA-2048: FALLIDA\n\n`;
                }
            } catch (error) {
                const results = document.getElementById('testResults');
                results.value += `‚ùå PRUEBA RSA-2048: ERROR DE CONEXI√ìN\n\n`;
            }
        }
        
        async function runVigenereTest() {
            try {
                const response = await fetch('http://localhost:5000/api/crypto/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'vigenere' })
                });
                
                const data = await response.json();
                const results = document.getElementById('testResults');
                
                if (response.ok && data.tests['Vigen√®re'].success) {
                    results.value += `‚úÖ PRUEBA VIGEN√àRE: EXITOSA\n`;
                    results.value += `   Texto original: "${data.tests['Vigen√®re'].original}"\n`;
                    results.value += `   Texto cifrado: "${data.tests['Vigen√®re'].encrypted}"\n`;
                    results.value += `   Clave: "${data.tests['Vigen√®re'].key}"\n`;
                    results.value += `   Coinciden: ${data.tests['Vigen√®re'].success ? 'S√ç' : 'NO'}\n\n`;
                } else {
                    results.value += `‚ùå PRUEBA VIGEN√àRE: FALLIDA\n\n`;
                }
            } catch (error) {
                const results = document.getElementById('testResults');
                results.value += `‚ùå PRUEBA VIGEN√àRE: ERROR DE CONEXI√ìN\n\n`;
            }
        }
        
        async function runSha256Test() {
            try {
                const response = await fetch('http://localhost:5000/api/crypto/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'sha256' })
                });
                
                const data = await response.json();
                const results = document.getElementById('testResults');
                
                if (response.ok) {
                    results.value += `‚úÖ PRUEBA SHA-256: EXITOSA\n`;
                    results.value += `   Texto original: "${data.tests.SHA256.original}"\n`;
                    results.value += `   Hash generado: ${data.tests.SHA256.hash}\n`;
                    results.value += `   Longitud del hash: ${data.tests.SHA256.length} caracteres\n\n`;
                } else {
                    results.value += `‚ùå PRUEBA SHA-256: FALLIDA\n\n`;
                }
            } catch (error) {
                const results = document.getElementById('testResults');
                results.value += `‚ùå PRUEBA SHA-256: ERROR DE CONEXI√ìN\n\n`;
            }
        }
        
        // Cargar datos iniciales
        testConnection();
        loadDocuments();
        loadLogs();
        loadProfile();
        
        // Establecer algoritmo por defecto
        document.querySelector('.algo-btn.active').click();
        
        // Cargar datos de ejemplo
        setTimeout(() => {
            document.getElementById('inputText').value = "Texto de ejemplo para pruebas criptogr√°ficas";
        }, 500);
    </script>
</body>
</html>